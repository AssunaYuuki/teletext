<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üì∫ –¢–µ–ª–µ—Ç–µ–∫—Å—Ç –ü–ª–µ–µ—Ä</title>
  <link rel="stylesheet" href="/global.css">
  <style>
    .weather-time-header {
      position: fixed;
      top: 10px;
      right: 10px;
      background: var(--card-bg);
      border: 1px solid var(--accent);
      border-radius: 6px;
      padding: 10px 15px;
      color: var(--fg);
      font-family: var(--font-mono);
      font-size: 0.9rem;
      z-index: 1000;
      box-shadow: 0 4px 8px var(--shadow);
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 4px;
    }

    .time-display {
      font-weight: bold;
    }

    .weather-display {
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .country-bar {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
      padding: 12px 0;
      margin-top: 60px; /* –û—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É –∑–∞–≥–æ–ª–æ–≤–∫–∞ —Å –ø–æ–≥–æ–¥–æ–π */
      margin-bottom: 20px;
    }

    .country-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: var(--card-bg);
      border: 1px solid var(--accent);
      border-radius: 6px;
      padding: 12px 18px;
      color: var(--fg);
      text-decoration: none;
      font-family: var(--font-mono);
      font-size: 1rem;
      transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
      min-width: 130px;
      justify-content: center;
    }
    .country-btn:hover {
      background: var(--hover-bg);
      color: var(--accent);
      transform: translateY(-2px) scale(1.02);
      box-shadow: 0 8px 16px var(--shadow-deep), 0 0 10px var(--shadow);
      border-color: #00ffaa;
    }

    .country-btn svg {
      width: 20px;
      height: 14px;
    }

    .country-btn span {
      white-space: nowrap;
    }

    /* –î–ª—è –º–æ–±–∏–ª–æ–∫ */
    @media (max-width: 600px) {
      .weather-time-header {
        position: static;
        order: -1;
        align-self: flex-end;
        margin-bottom: 20px;
      }
      .country-btn {
        min-width: 90px;
        padding: 8px 12px;
        font-size: 0.85rem;
      }
      .country-btn svg {
        width: 16px;
        height: 11px;
      }
    }
  </style>
</head>
<body>

  <!-- –ë–ª–æ–∫ —Å –ø–æ–≥–æ–¥–æ–π –∏ –≤—Ä–µ–º–µ–Ω–µ–º -->
  <div class="weather-time-header">
    <div class="time-display" id="localTime">--:--:--</div>
    <div class="weather-display" id="localWeather">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
  </div>

  <header>
    <h1>üì∫ –¢–µ–ª–µ—Ç–µ–∫—Å—Ç –ü–ª–µ–µ—Ä</h1>
    <p class="subtitle">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É –∏–ª–∏ –∞—Ä—Ö–∏–≤</p>
  </header>

  <div class="country-bar">
    <% if (folders && folders.length > 0) { %>
      <% folders.forEach(folder => { %>
        <a href="/folder/<%= encodeURIComponent(folder) %>" class="country-btn">
          <%
            let flagSVG = '';
            switch(folder) {
              case 'Belarus': flagSVG = '<svg viewBox="0 0 3 2" xmlns="http://www.w3.org/2000/svg"><rect width="3" height="2" fill="#fff"/><rect width="3" height=".666" y="1.333" fill="#ce1126"/><rect width="3" height=".666" fill="#009639"/><path d="M0 0h.75v2H0z" fill="#ce1126"/></svg>'; break;
              case 'Belgium': flagSVG = '<svg viewBox="0 0 3 2" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="2" fill="#000"/><rect width="1" height="2" x="1" fill="#ffd700"/><rect width="1" height="2" x="2" fill="#ff0000"/></svg>'; break;
              case 'Britannia':
              case 'London': flagSVG = '<svg viewBox="0 0 64 48" xmlns="http://www.w3.org/2000/svg"><rect width="64" height="48" fill="#012169"/><path d="M0 0L64 48M64 0L0 48" stroke="#FFF" stroke-width="12"/><path d="M0 0L64 48M64 0L0 48" stroke="#C8102E" stroke-width="6"/><path d="M32 0v48M0 24h64" stroke="#FFF" stroke-width="10"/><path d="M32 0v48M0 24h64" stroke="#C8102E" stroke-width="4"/></svg>'; break;
              case 'Denmark': flagSVG = '<svg viewBox="0 0 37 28" xmlns="http://www.w3.org/2000/svg"><rect width="37" height="28" fill="#c60c30"/><rect width="6" height="28" x="12" fill="#fff"/><rect width="37" height="6" y="11" fill="#fff"/></svg>'; break;
              case 'France': flagSVG = '<svg viewBox="0 0 3 2" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="2" fill="#002395"/><rect width="1" height="2" x="1" fill="#fff"/><rect width="1" height="2" x="2" fill="#ED2939"/></svg>'; break;
              case 'Germany': flagSVG = '<svg viewBox="0 0 3 2" xmlns="http://www.w3.org/2000/svg"><rect width="3" height="2" fill="#FFCE00"/><rect width="3" height=".666" y="1.333" fill="#D00"/><rect width="3" height=".666" fill="#000"/></svg>'; break;
              case 'Italian': flagSVG = '<svg viewBox="0 0 3 2" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="2" fill="#009246"/><rect width="1" height="2" x="1" fill="#fff"/><rect width="1" height="2" x="2" fill="#CE2B37"/></svg>'; break;
              case 'Netherlands': flagSVG = '<svg viewBox="0 0 9 6" xmlns="http://www.w3.org/2000/svg"><rect width="9" height="6" fill="#21468B"/><rect width="9" height="2" fill="#AE1C28"/><rect width="9" height="2" y="2" fill="#FFF"/></svg>'; break;
              case 'Norway': flagSVG = '<svg viewBox="0 0 22 16" xmlns="http://www.w3.org/2000/svg"><rect width="22" height="16" fill="#EF2B2D"/><rect width="22" height="4" y="6" fill="#fff"/><rect width="4" height="16" x="6" fill="#fff"/><rect width="22" height="2" y="7" fill="#002F6C"/><rect width="2" height="16" x="7" fill="#002F6C"/></svg>'; break;
              case 'Poland': flagSVG = '<svg viewBox="0 0 16 10" xmlns="http://www.w3.org/2000/svg"><rect width="16" height="10" fill="#DC143C"/><rect width="16" height="5" fill="#fff"/></svg>'; break;
              case 'Russia': flagSVG = '<svg viewBox="0 0 3 2" xmlns="http://www.w3.org/2000/svg"><rect width="3" height="2" fill="#FFF"/><rect width="3" height=".666" y="1.333" fill="#D52B1E"/><rect width="3" height=".666" y=".666" fill="#0039A6"/></svg>'; break;
              case 'Sweden': flagSVG = '<svg viewBox="0 0 16 10" xmlns="http://www.w3.org/2000/svg"><rect width="16" height="10" fill="#006aa7"/><rect width="16" height="4" y="3" fill="#fecc00"/><rect width="5" height="10" x="5" fill="#fecc00"/></svg>'; break;
            }
          %>
          <span><%- flagSVG %></span>
          <span><%= folder %></span>
        </a>
      <% }) %>
    <% } else { %>
      <div class="empty">
        <p>üìÅ –ü–∞–ø–∫–∞ <code>teletext/</code> –ø—É—Å—Ç–∞ –∏–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.</p>
        <p>–ü–æ–ª–æ–∂–∏—Ç–µ HTML-—Ñ–∞–π–ª—ã, –Ω–∞–ø—Ä–∏–º–µ—Ä:<br>
          <code>teletext/Belarus/–ë–ï–õ–¢–ï–ö 7.12.1999/100.html</code></p>
      </div>
    <% } %>
  </div>

  <footer>
    <a href="/about" class="btn">‚ÑπÔ∏è –û –ø—Ä–æ–µ–∫—Ç–µ</a>
    <small>By AssunaYuuki 2025 year</small>
  </footer>

    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div id="loadingIndicator" class="loading-indicator">
      <div class="loading-bar"></div>
    </div>

<script src="/js/protect.js"></script>
<script>
  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
  function updateLocalTime() {
    const now = new Date();
    const timeString = now.toLocaleTimeString('ru-RU', {
      hour: '2-digit',
      minute: '2-digit',
      second: '2-digit'
    });
    const dateString = now.toLocaleDateString('ru-RU', {
      day: '2-digit',
      month: '2-digit',
      year: 'numeric'
    });
    // –û–±—ä–µ–¥–∏–Ω—è–µ–º –≤ –æ–¥–∏–Ω —ç–ª–µ–º–µ–Ω—Ç, –¥–æ–±–∞–≤–∏–≤ –µ–≥–æ –≤ HTML
    document.querySelector('.time-display').innerHTML = `${dateString}<br>${timeString}`;
  }

  setInterval(updateLocalTime, 1000);
  updateLocalTime();

  // –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–≥–æ–¥—ã
  async function getWeatherAndLocation() {
    const weatherDisplay = document.getElementById('localWeather');

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞
    if (location.protocol !== 'https:' && !location.host.includes('localhost')) {
      weatherDisplay.textContent = 'HTTPS —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏';
      return;
    }

    try {
      // –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
      const position = await new Promise((resolve, reject) => {
        if (!navigator.geolocation) {
          reject(new Error("–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è"));
          return;
        }
        navigator.geolocation.getCurrentPosition(resolve, reject, {
          enableHighAccuracy: true,
          timeout: 10000, // –£–≤–µ–ª–∏—á–µ–Ω —Ç–∞–π–º–∞—É—Ç
          maximumAge: 300000 // –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å –¥–æ 5 –º–∏–Ω—É—Ç
        });
      });

      const { latitude, longitude } = position.coords;

      // –ó–∞–ø—Ä–æ—Å –ø–æ–≥–æ–¥—ã —á–µ—Ä–µ–∑ proxy –∏–ª–∏ –Ω–∞–ø—Ä—è–º—É—é (–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç CORS)
      const API_KEY = '674ca86e6c1ca2d60eb3317d58e0c5a7';
      // –ò—Å–ø–æ–ª—å–∑—É–µ–º CORS Anywhere proxy –∏–ª–∏ –¥–µ–ª–∞–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä
      const proxyUrl = ''; // –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ–∫—Å–∏, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
      const apiUrl = `https://api.openweathermap.org/data/2.5/weather?lat=${latitude}&lon=${longitude}&lang=ru&units=metric&appid=${API_KEY}`;

      const response = await fetch(apiUrl);

      if (!response.ok) {
        throw new Error(`OpenWeather: ${response.status} ${response.statusText}`);
      }

      const data = await response.json();
      const temp = Math.round(data.main.temp);
      const description = data.weather[0].description;
      const city = data.name;

      weatherDisplay.innerHTML = `<span>${city}</span>, <span>${temp}¬∞C, ${description}</span>`;
    } catch (error) {
      console.error("–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–≥–æ–¥—ã:", error);
      weatherDisplay.textContent = `–û—à–∏–±–∫–∞: ${error.message}`;

      // –í—Ç–æ—Ä–∏—á–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ IP, –µ—Å–ª–∏ –≥–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∞
      if (error.message.includes("geolocation") || error.message.includes("HTTPS")) {
        try {
          const ipResponse = await fetch('https://ipapi.co/json/', {
            headers: { 'Accept': 'application/json' }
          });
          if (!ipResponse.ok) throw new Error("IP API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω");

          const locData = await ipResponse.json();
          weatherDisplay.innerHTML = `<span>${locData.city || '–ì–æ—Ä–æ–¥'}</span>`;
        } catch (ipErr) {
          console.warn("–û—à–∏–±–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è –ø–æ IP:", ipErr.message);
          weatherDisplay.textContent = '–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ';
        }
      }
    }
  }

  // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ DOM
  document.addEventListener('DOMContentLoaded', () => {
    // –ü—Ä–æ–≤–µ—Ä–∫–∞, –µ—Å—Ç—å –ª–∏ –¥–æ—Å—Ç—É–ø –∫ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏
    if ("geolocation" in navigator) {
      getWeatherAndLocation();
    } else {
      document.getElementById('localWeather').textContent = '–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞';
    }
  });


</script>




</body>
</html>