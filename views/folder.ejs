<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= folderName %> ‚Äî –°—Ç—Ä–∞–Ω–∏—Ü—ã</title>
  <link rel="stylesheet" href="/global.css">
  <style>
    .folder-container {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      padding: 20px 0;
      background: var(--bg);
      color: var(--fg);
      font-family: var(--font-mono);
    }

    .content-wrapper {
      width: 100%;
      max-width: 1000px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      margin-bottom: 20px;
      border-bottom: 1px solid var(--accent);
      padding-bottom: 10px;
    }

    .header h1 {
      color: var(--accent);
      margin: 0;
      font-size: 2rem;
      text-shadow: 0 0 8px rgba(0, 204, 102, 0.6);
    }

    .breadcrumb {
      font-size: 0.9rem;
      opacity: 0.7;
      margin-top: 5px;
    }

    .breadcrumb a {
      color: var(--accent);
      text-decoration: none;
    }
    .breadcrumb a:hover {
      text-decoration: underline;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 12px;
      margin-top: 10px;
    }

    .card {
      position: relative; /* ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –∞–±—Å–æ–ª—é—Ç–Ω–æ–≥–æ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è */
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 12px;
      background: var(--card-bg);
      border: 1px solid var(--accent);
      border-radius: 6px;
      text-decoration: none;
      color: var(--fg);
      transition: all 0.2s ease;
      width: 100%;
      height: 100%;
      box-sizing: border-box;
    }

    .card:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 12px rgba(0, 255, 136, 0.2);
      border-color: #00ffaa;
    }

    .edit-btn-wrapper {
      position: absolute;
      top: 4px;
      right: 4px;
      width: 15px;
      height: 16px;
      padding: 2px;
      background: transparent;
      border: none;
      border-radius: 2px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 10;
      transition: all 0.2s;
      box-shadow: none;
      outline: none;
      text-decoration: none;
      pointer-events: auto;
    }

    .edit-btn-wrapper span {
      font-size: 0.7rem;
      color: #ff6600;
      font-weight: bold;
      margin: 0;
      padding: 0;
      line-height: 1;
      text-decoration: none;
    }

    .thumbs-grid {
      margin-top: 30px;
    }

    .thumbs-grid .grid {
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
    }

    .thumb-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 6px;
      border: 1px solid var(--accent);
      border-radius: 4px;
      text-decoration: none;
      color: var(--fg);
    }

    .thumb-item img {
      width: 100%;
      height: 80px;
      object-fit: cover;
      border-radius: 3px;
    }

    /* –ü–æ–¥—Å–∫–∞–∑–∫–∞ ‚Äî —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ */
    .tooltip {
      position: absolute;
      top: 0;
      left: 100%;
      margin-left: 10px;
      padding: 10px;
      background: rgba(14, 20, 16, 0.9);
      border: 1px solid var(--accent);
      border-radius: 4px;
      color: var(--fg);
      font-size: 0.9rem;
      white-space: pre-line;
      z-index: 100;
      display: none;
      box-shadow: 0 0 10px rgba(0, 255, 153, 0.3);
      max-width: 250px;
      line-height: 1.4;
      /* ‚úÖ –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è */
      opacity: 0;
      transform: translateX(10px);
      transition: opacity 0.2s ease, transform 0.2s ease;
    }

    .card:hover .tooltip {
      display: block;
      opacity: 1;
      transform: translateX(0);
    }
  </style>
</head>
<body>

  <header class="nav-bar">
    <div class="breadcrumb">
      <a href="/">üè† –ì–ª–∞–≤–Ω–∞—è</a>
      <% if (breadcrumb && breadcrumb.length > 0) { %>
        <% breadcrumb.forEach((crumb, i) => { %>
          <% if (i === breadcrumb.length - 1) { %>
            <span> ‚Üí <%= crumb.name %></span>
          <% } else { %>
            <a href="/folder/<%= crumb.path %>"> ‚Üí <%= crumb.name %></a>
          <% } %>
        <% }) %>
      <% } %>
    </div>

    <h2>
      <% if (hasLogo) { %>
        <img id="header-logo" src="<%= logoUrl %>?t=<%= Date.now() %>" alt="–õ–æ–≥–æ—Ç–∏–ø" style="height:32px;vertical-align:middle;margin-right:8px;">
      <% } %>
      <%= folderName %>
    </h2>
  </header>

  <div class="folder-container">
    <div class="content-wrapper">
      <div class="header">
        <h1><%= folderName %></h1>
        <div class="breadcrumb">
          –ü–æ–¥–ø–∞–ø–æ–∫: <%= folders.length %>, —Å—Ç—Ä–∞–Ω–∏—Ü: <%= pages.length %>
        </div>
      </div>

      <% if (folders.length > 0) { %>
        <section>
          <h3>üìÅ –ü–æ–¥–ø–∞–ø–∫–∏</h3>
          <div class="grid">
            <% folders.forEach(folder => {
                const card = folderCards[folder] || {};
                const logoUrl = card.logoUrl;
                const displayName = card.displayName || folder;
                const description = card.description || ''; // ‚úÖ –ü–æ–ª—É—á–∞–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ
            %>
              <div class="card-container" style="position:relative; display:inline-block;">
                <a href="/folder/<%= currentPath ? currentPath + '/' + folder : folder %>"
                   class="card"
                   data-logo="<%= logoUrl || '' %>"
                   data-folder="<%= folder %>"
                   data-path="<%= currentPath ? currentPath + '/' + folder : folder %>"
                   onclick="updateHeaderLogo(this); return true;"
                   onmouseenter="showEditButton(this)"
                   onmouseleave="hideEditButton(this)">

                  <!-- –õ–æ–≥–æ—Ç–∏–ø -->
                  <% if (logoUrl) { %>
                    <img src="<%= logoUrl %>?t=<%= Date.now() %>" alt="–õ–æ–≥–æ—Ç–∏–ø" style="height:32px; max-width: 100%; object-fit: contain; margin-top:8px;">
                  <% } else { %>
                    <span style="color:#ffcc00;font-size:1.2rem;">üåê</span>
                  <% } %>

                  <!-- –ù–∞–∑–≤–∞–Ω–∏–µ -->
                  <span style="font-size:0.85rem; text-align:center; display:block; word-wrap:break-word; line-height:1.2; margin-top:6px;"><%= displayName %></span>

                  <!-- –ü–æ–¥—Å–∫–∞–∑–∫–∞ -->
                  <% if (description && description.trim()) { %>
                    <div class="tooltip"><%= description %></div>
                  <% } %>

                </a>
              </div>
            <% }) %>
          </div>
        </section>
      <% } %>

      <% if (pages.length > 0) { %>
        <section class="thumbs-grid">
          <h3>üñºÔ∏è –°—Ç—Ä–∞–Ω–∏—Ü—ã</h3>
          <div class="grid">
            <% pages.forEach(item => { %>
              <a href="/page/<%= currentPath %>/<%= item.page %>" class="thumb-item">
                <% if (item.hasThumb) { %>
                  <img src="<%= `/teletext/${currentPath}/${item.page}.png` %>" alt="–°—Ç—Ä. <%= item.page %>">
                <% } else { %>
                  <div style="height:80px; width:100%; background:#0a220a; display:flex; align-items:center; justify-content:center; color:#00ff88; font-size:1.1rem; font-weight:bold;">
                    <%= item.page %>
                  </div>
                <% } %>
                <span style="margin-top:4px; font-size:0.85rem;"><%= item.page %></span>
              </a>
            <% }) %>
          </div>
        </section>
      <% } else if (folders.length === 0) { %>
        <div class="empty" style="text-align:center; margin-top:40px;">
          <p>–ù–µ—Ç –Ω–∏ –ø–æ–¥–ø–∞–ø–æ–∫, –Ω–∏ —Å—Ç—Ä–∞–Ω–∏—Ü.</p>
        </div>
      <% } %>

      <footer style="margin-top: 30px; text-align: center; font-size: 0.85rem; opacity: 0.7;">
        <small>–¢–µ–ª–µ—Ç–µ–∫—Å—Ç | –ü—É—Ç—å: <%= currentPath || '–∫–æ—Ä–µ–Ω—å' %></small>
      </footer>
    </div>
  </div>

  <script>
    function updateHeaderLogo(card) {
      const logoUrl = card.getAttribute('data-logo');
      const headerLogo = document.getElementById('header-logo');
      if (headerLogo && logoUrl) {
        headerLogo.style.opacity = '0';
        setTimeout(() => {
          headerLogo.src = logoUrl + '?t=' + Date.now();
          headerLogo.style.opacity = '1';
        }, 100);
      }
    }

    function showEditButton(card) {
      // –°–æ–∑–¥–∞—ë–º –∫–Ω–æ–ø–∫—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
      const btn = document.createElement('a');
      btn.className = 'edit-btn-wrapper';
      btn.href = `/edit-card/${card.dataset.path}`;
      btn.title = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É';
      btn.innerHTML = '<span>‚úèÔ∏è</span>';
      btn.addEventListener('click', (e) => {
        e.stopPropagation(); // —á—Ç–æ–±—ã –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–ª–æ –∫–ª–∏–∫ –ø–æ –∫–∞—Ä—Ç–æ—á–∫–µ
      });
      card.appendChild(btn);
    }

    function hideEditButton(card) {
      const btn = card.querySelector('.edit-btn-wrapper');
      if (btn) {
        card.removeChild(btn);
      }
    }
  </script>

</body>
</html>